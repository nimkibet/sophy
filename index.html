<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophy Surprise</title>
    <link rel="stylesheet" href="main.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
        <div id="welcome-overlay">
        <div id="welcome-content">
            <button id="surprise-btn">Open your surprise Sophy</button>
            <h1 id="loved-text" style="display: none;">You are loved</h1>
        </div>
    </div>

        <div id="drag-container">
        <div id="spin-container">
            <img src="./images/r1.jpeg" alt="">
            <img src="./images/r2.jpeg" alt="">
            <img src="./images/r3.jpeg" alt="">
            <img src="./images/r4.jpeg" alt="">
            <img src="./images/r5.png" alt="">
            <img src="./images/r6.jpg" alt="">
            <img src="./images/r7.jpg" alt="">
            <img src="./images/r8.jpg" alt="">
            <img src="./images/r9.jpg" alt="">
            <img src="./images/r10.jpg" alt="">
            <img src="./images/r11.png" alt="">
                 
            <p>You are loved Sophy</p>
        </div>
        <div id="ground"></div>
    </div>
    <div id="nimrod-text">From Nimrod</div>

    
    <canvas id="webgl-canvas"></canvas>

    <canvas id="canvas"></canvas>

    <audio id="myAudio" loop>
        <source src="music/setlove.mp3" type="audio/mpeg">
    </audio>

    <script src="main.js"></script>

   <script>
    // 1. Pre-load the main script to ensure functions are ready
    var script = document.createElement('script');
    script.src = "love/main.js"; 
    document.body.appendChild(script);

    window.addEventListener('load', function() {
        var btn = document.getElementById('surprise-btn');
        var overlay = document.getElementById('welcome-overlay');
        var nimrodText = document.getElementById('nimrod-text');
        var audio = document.getElementById("myAudio");

        // Hide the "From Nimrod" text initially so it doesn't overlap the welcome screen
        if(nimrodText) nimrodText.style.opacity = '0';

        btn.addEventListener('click', function() {
            // A. Immediate Visual Feedback: Disable button to prevent double clicks
            btn.style.pointerEvents = 'none';
            btn.innerHTML = "Opening..."; // Optional: Change text to show action
            btn.style.opacity = '0.7';

            // B. Start Audio (This is what usually lags, so we wrap it)
            if (window.setupAudioContext) {
                // Try to start audio, but don't let it block the UI fade
                setTimeout(() => window.setupAudioContext(), 10);
            } else if(audio) {
                audio.play().catch(e => console.log("Audio play blocked", e));
            }

            // C. Fade Out Overlay Smoothly
            overlay.style.transition = "opacity 1.5s ease-out";
            overlay.style.opacity = '0';
            
            // D. Reveal the Site content
            setTimeout(function() {
                overlay.style.display = 'none';
                
                // Fade in the Nimrod text now that the site is visible
                if(nimrodText) {
                    nimrodText.style.transition = "opacity 2s ease-in";
                    nimrodText.style.opacity = '1';
                }
                
                // Trigger the heart animation sequence (from main.js)
                if (window.startSequence) {
                    window.startSequence();
                }
            }, 1500); // Matches the CSS transition time
            
        }, { once: true });
    });
</script>
</body>
</html>